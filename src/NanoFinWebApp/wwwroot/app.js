var app=angular.module("myApp",["ngRoute","ngMaterial","ngMessages","ngCookies","auth0","angular-storage","angular-jwt","ngSanitize","ngLoadScript"]);app.config(function($routeProvider,$locationProvider,authProvider,$httpProvider,jwtInterceptorProvider,jwtOptionsProvider){$routeProvider.when("/",{redirectTo:function(){return"/home"}}).when("/home",{title:"NanoFin Home",templateUrl:"/views/components/home/home.html",controller:"homePageController",requiresLogin:!1}).when("/about",{title:"About",templateUrl:"/views/components/common/about.html",controller:"aboutPageController",requiresLogin:!1}).when("/login",{title:"Login",templateUrl:"/views/components/home/login.html",controller:"loginCtrl",requiresLogin:!1}).when("/reseller",{title:"Reseller",templateUrl:"/views/components/reseller/home.html",controller:"resellerPageController",requiresLogin:!1}).when("/resellerperformance",{title:"Reseller - performance",templateUrl:"/views/components/reseller/resellerPerformance.html",controller:"resellerPerformancePageController",requiresLogin:!1}).when("/resellersfindus",{title:"Find Us",templateUrl:"/views/components/reseller/resellerInfo.html",controller:"resellerInfoPageController",requiresLogin:!1}).when("/registerreseller",{title:"Register a Reseller",templateUrl:"/views/components/admin/registerAReseller.html",controller:"registerResellerPageController",requiresLogin:!0}).when("/admin",{title:"Admin Home",templateUrl:"/views/components/admin/adminHome.html",controller:"adminHomePageController",requiresLogin:!0}).when("/contact",{title:"Contact us",templateUrl:"/views/components/common/contact.html",controller:"contactPageController",requiresLogin:!1}).when("/catalog",{title:"Catalog",templateUrl:"/views/components/customer/catalog.html",controller:"catalogPageController",requiresLogin:!0}).when("/signup",{title:"Signup",templateUrl:"/views/components/customer/ConsumerSignUp.html",controller:"consumerSignUpPageController",requiresLogin:!1}).when("/purchaseproduct/:param1",{title:"Purchase Product",templateUrl:"/views/components/customer/purchaseproduct.html",controller:"purchaseprodCtrl",requiresLogin:!0}).when("/sendvoucher",{title:"Send Voucher",templateUrl:"/views/components/customer/sendvoucher.html",controller:"sendvoucherCtrl",requiresLogin:!1}).when("/wallet",{title:"Wallet",templateUrl:"/views/components/customer/wallet.html",controller:"walletCtrl",requiresLogin:!0}).when("/history",{title:"History",templateUrl:"/views/components/customer/history.html",controller:"historyCtrl",requiresLogin:!0}).when("/viewClaimHistories",{title:"Claim History",templateUrl:"/views/components/customer/viewClaimHistories.html",controller:"claimHistoryCtrl",requiresLogin:!0}).when("/profile",{title:"Profile",templateUrl:"/views/components/customer/profile.html",controller:"profileCtrl",requiresLogin:!0}).when("/claim/:param1",{title:"Claim",templateUrl:"/views/components/customer/claim.html",controller:"claimCtrl",requiresLogin:!0}).when("/claim2",{title:"Claim2",templateUrl:"/views/components/customer/claim2.html",controller:"SampleWizardController",requiresLogin:!0}).when("/claimSimple/:param1/:param2",{title:"Claim Simple",templateUrl:"/views/components/customer/claimSimple.html",controller:"claimSimpleCtrl",requiresLogin:!0}).when("/addbeneficiary",{title:"Add Beneficiary",templateUrl:"/views/components/customer/addbeneficiary.html",controller:"addBeneficiaryPageController",requiresLogin:!0}).when("/viewbeneficiaries",{title:"View Beneficiaries",templateUrl:"/views/components/customer/viewbeneficiaries.html",controller:"viewBeneficiariesPageController",requiresLogin:!0}).otherwise({templateUrl:"/views/components/home/home.html",controller:"homePageController"}),authProvider.init({domain:"nanofin.eu.auth0.com",clientID:"twXZJa9qjHoWSNSBXSi3GfL2148qiQ08",loginUrl:"/login"}),jwtOptionsProvider.config({whiteListedDomains:["http://nanofinapifinal.azurewebsites.net/","http://nanofinapibeta.azurewebsites.net/","http://localhost/","https://nanofinapifinal.azurewebsites.net"]}),jwtInterceptorProvider.tokenGetter=function(store){return store.get("token")},$httpProvider.interceptors.push("jwtInterceptor"),$locationProvider.html5Mode(!0)}),app.controller("homePageController",["$scope",function($scope){}]),app.controller("aboutPageController",["$scope","$window",function($scope,$window){$window.location.href="http://test.projectsday.info/t9/"}]),app.controller("consumerSignUpPageController",["$scope",function($scope){}]),app.controller("loginPageController",["$scope",function($scope){}]),app.controller("resellerPageController",["$scope",function($scope){$scope.title="Reseller"}]),app.controller("resellerPerformancePageController",["$scope",function($scope){$scope.title="Reseller"}]),app.controller("resellerInfoPageController",["$scope",function($scope){$scope.title="resellerInfo"}]),app.controller("adminHomePageController",["$scope",function($scope){}]),app.controller("registerResellerPageController",["$scope",function($scope){$scope.title="registerreseller"}]),app.controller("contactPageController",["$scope","$window",function($scope,$window){$window.location.href="http://test.projectsday.info/t9/"}]),app.controller("catalogPageController",["$scope",function($scope){$scope.title="Catalog"}]),app.controller("purchasePageController",["$scope",function($scope){$scope.title="Purchase"}]),app.controller("sendvoucherPageController",["$scope",function($scope){$scope.title="Send"}]),app.controller("walletPageController",["$scope",function($scope){$scope.title="Wallet"}]),app.controller("historyPageController",["$scope",function($scope){$scope.title="History"}]),app.controller("profilePageController",["$scope",function($scope){$scope.title="Profile"}]),app.controller("claimPageController",["$scope",function($scope){$scope.title="Claim"}]),app.controller("Claim2PageController",["$scope",function($scope){$scope.title="Claim2"}]),app.controller("claimSimplePageController",["$scope",function($scope){$scope.title="ClaimSimple"}]),app.controller("addBeneficiaryPageController",["$scope",function($scope){$scope.title="ClaimSimple"}]),app.controller("viewBeneficiariesPageController",["$scope",function($scope){$scope.title="ClaimSimple"}]),app.controller("claimHistoryPageController",["$scope",function($scope){$scope.title="ClaimSimple"}]),app.run(function($rootScope,$route,auth,store,jwtHelper,$location){auth.hookEvents(),$rootScope.$on("$locationChangeStart",function(){}),$rootScope.$on("$routeChangeSuccess",function(){document.title=$route.current.title})}),angular.module("myApp").controller("AdminCtrl",function($scope,$http,$mdToast,$log,$interval,notificationService,userSessionService){$scope.baseURL="https://nanofinapifinal.azurewebsites.net",$scope.unvalidatedConsumers={},$scope.productProvierInformation={};var getProductProviderInformation=function(){$http({method:"GET",url:$scope.baseURL+"/api/ProductProvider/getProductProviderAgregatePaymentInfo?productProviderID=51"}).then(function(response){$scope.productProvierInformation=response.data,$log.info(response)},function(reason){$log.info(reason)})},getTotalOwedToProductProvider=function(){$http({method:"GET",url:$scope.baseURL+"/ProductProvider/getTotalOwedToPP?productProviderID=11"}).then(function(response){$scope.productProvierInformation.totalCashedOwed=response.data,$log.info(response)},function(reason){$log.info(reason)})};getProductProviderInformation(),getTotalOwedToProductProvider();var getUnvalidatedConsumers=function(){$http({method:"GET",url:$scope.baseURL+"/api/Admin/getUnvalidatedConsumers"}).then(function(response){$scope.unvalidatedConsumers=response.data,$log.info(response)},function(reason){$log.info(reason)})};$scope.acceptConsumer=function(userID){$http({method:"PUT",url:$scope.baseURL+"/api/Admin/acceptConsumer?userID="+userID}).then(function(response){getUnvalidatedConsumers(),$log.info(response)},function(reason){$log.info(reason)})},$scope.rejectConsumer=function(userID){$http({method:"PUT",url:$scope.baseURL+"/api/Admin/rejectConsumer?userID="+userID}).then(function(response){getUnvalidatedConsumers(),$log.info(response)},function(reason){$log.info(reason)})},getUnvalidatedConsumers()}),angular.module("myApp").directive("fileInput",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){element.bind("change",function(){$parse(attrs.fileInput).assign(scope,element[0].files),scope.$apply()})}}}]).controller("registerResellerCtrl",function($scope,$http,$mdToast,$log,$timeout,$location,$mdDialog){$scope.baseURL=$scope.baseURL="https://nanofinapifinal.azurewebsites.net",$scope.currentStep=0,$scope.numSteps=3,$scope.showToolTip=!1,$scope.isFormComplete=!1,$scope.showPagination=!0,$scope.showComplete=!1,$scope.showIncompleteBack=!1,$scope.showCardExp=!1,$scope.show1=!0,$scope.show2=!1,$scope.show3=!1,$scope.show4=!1,$scope.isCardExpComplete=function(){angular.isDefined($scope.reseller.cardExp.MM)&&angular.isDefined($scope.reseller.cardExp.YY)&&($scope.showCardExp=!0)};var postReseller=function(){$http({method:"POST",url:$scope.baseURL+"/api/signup/postReseller?fName="+$scope.reseller.firstName+"&lName="+$scope.reseller.lastName+"&userName="+$scope.reseller.username+"&email="+$scope.reseller.email+"&contactNum="+$scope.reseller.phoneNumber+"&userPass="+$scope.reseller.password+"&IDnumber="+$scope.reseller.ID+"&cardNumber="+$scope.reseller.cardNumber+"&cardExpiration="+$scope.reseller.cardExp.MM+"/"+$scope.reseller.cardExp.YY+"&cardCVV="+$scope.reseller.CVV+"&nameOnCard="+$scope.reseller.nameOnCard+"&bankName="+$scope.reseller.bankName+"&DOB="+$scope.reseller.DOB}).then(function(response){$log.info(response),$location.path("/home")},function(reason){$log.info(reason),console.log("the error"),console.log(reason.data.Message),$scope.currentStep=0,$scope.showCurrentDiv(1),$scope.showPagination=!0,$scope.showComplete=!1,$scope.showIncompleteBack=!1,"email taken"===reason.data.Message?alert("Email has already been taken. Please choose another email"):"Username taken"===reason.data.Message&&alert("Username has already been taken. Please choose another user name.")})};$scope.showCurrentDiv=function(divNumber){$scope.show1=!1,$scope.show2=!1,$scope.show3=!1,$scope.show4=!1,1===divNumber?$scope.show1=!0:2===divNumber?$scope.show2=!0:3===divNumber?$scope.show3=!0:4===divNumber&&($scope.show4=!0)},$scope.completeSignup=function(){$scope.show3=!1,postReseller()},$scope.incrementStep=function(form){$scope.currentStep=$scope.currentStep+1,$scope.currentStep>=$scope.numSteps-1&&(form.$valid===!1?$scope.showIncompleteBack=!0:form.$valid===!0&&($scope.showComplete=!0),$scope.showPagination=!1),$scope.showCurrentDiv($scope.currentStep+1)},$scope.decrementStep=function(){$scope.currentStep=$scope.currentStep-1,$scope.currentStep>0&&($scope.showPagination=!0,$scope.showComplete=!1,$scope.showIncompleteBack=!1),$scope.showCurrentDiv($scope.currentStep+1)};var count=0;$scope.$watch("resellerSignUp.$valid",function(){$scope.resellerSignUp.$valid===!0?0===count?count++:$scope.currentStep>=$scope.numSteps-1&&($scope.showIncompleteBack=!1,$scope.showPagination=!1,$scope.showComplete=!0):$scope.resellerSignUp.$valid===!1&&($scope.currentStep>=$scope.numSteps-1?($scope.showIncompleteBack=!0,$scope.showPagination=!1,$scope.showComplete=!1):($scope.showIncompleteBack=!1,$scope.showPagination=!0,$scope.showComplete=!1))}),$scope.uploading=!1;var fd=new FormData;$scope.upload=function(files){console.log("uploading"),$scope.uploading=!0,console.log(files);for(var i=0;i<files.length;i++){var fsize=files.item(i).size;if(console.log("file size:"+fsize),fsize/1024>=2048)return $scope.showMaxFileSizeAlert(),void($scope.uploading=!1)}angular.forEach(files,function(value,key){fd.append(key,value)}),$http.post($scope.baseURL+"/api/FileUpload/uploadToNewDirectory?strDirectory=userDocs/reseller/ID_BankStatement/"+$scope.reseller.email,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(d){$scope.uploading=!1,$scope.showAlert(files),console.log(d)}).error(function(){$scope.uploading=!1,alert("Failed!")})},$scope.showMaxFileSizeAlert=function(){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("The size of one or more files is more than 2 MiB").textContent("Please try to upload files of smaller sizes.").ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.showAlert=function(files){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("File(s) Uploaded Successfully:").textContent($scope.NamesList(files)).ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.NamesList=function(files){for(var namesStr="",i=0;i<files.length;i++)namesStr=namesStr+files[i].name+"  \r\n";return namesStr}}),angular.module("myApp").controller("beneficiariesCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService,$mdDialog,$location,$window){$scope.baseURL="https://nanofinapifinal.azurewebsites.net/api",$scope.searchBeneficiary="",userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,$scope.isLoadingUser=!1,$scope.beneficiaryFound=!1,$scope.isLoadingAdd=!1;var showToast=function(message,parentId){var parentElement=angular.element(document.getElementById(parentId)),toast=$mdToast.simple().content(message).action("OK").highlightAction(!0).hideDelay(0).position("bottom right").parent(parentElement).hideDelay(5e3);$mdToast.show(toast)};$scope.getUser=function(userNameOrEmail,contactNum,toastParentID){$scope.isLoadingUser=!0,void 0===userNameOrEmail&&void 0===contactNum?($scope.isLoadingUser=!1,showToast("Please enter Username/Email and Mobile number",toastParentID)):void 0===userNameOrEmail?($scope.isLoadingUser=!1,showToast("Please enter Username/Email",toastParentID)):void 0===contactNum?($scope.isLoadingUser=!1,showToast("Please enter Mobile number",toastParentID)):$http({method:"GET",url:$scope.baseURL+"/ContactList/getUserFromContactNumberAndUserNameOrEmail?userNameOrEmail="+userNameOrEmail+"&contactNum="+contactNum}).then(function(response){$scope.isLoadingUser=!1;var varBeneficiary=response.data;if($scope.beneficiary=varBeneficiary,null===$scope.beneficiary)$scope.beneficiaryFound=!1,showToast("User not found, please ensure the details are correct",toastParentID);else{var vbeneficiaryUserID=varBeneficiary.User_ID;$scope.beneficiaryUserID=vbeneficiaryUserID;var vbeneficiaryFirstName=varBeneficiary.userFirstName;$scope.beneficiaryFirstName=vbeneficiaryFirstName;var vbeneficiaryLastName=varBeneficiary.userLastName;$scope.beneficiaryLastName=vbeneficiaryLastName,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ContactList/contactAlreadyExists?UserID="+$scope.consumerUserID+"&contactID="+$scope.beneficiaryUserID}).then(function(response){$scope.contactAlreadyExists=response.data,$scope.contactAlreadyExists===!0?($scope.beneficiaryFound=!1,showToast("This user is already one of your beneficiaries",toastParentID)):$scope.contactAlreadyExists===!1&&($scope.beneficiaryFound=!0),$log.info(response)},function(reason){$log.info(reason)})}$log.info(response)},function(reason){$scope.isLoadingUser=!1,$log.info(reason)})},$scope.isResend=!1,$scope.addBeneficiary=function(){$scope.isLoadingAdd=!0,$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/sendUserOTPAndSaveOTP?UserID="+$scope.consumerUserID+"&isResend="+$scope.isResend}).then(function(response){"OTP Sent sucessfully first time"==response.data&&($scope.showOTPPrompt(),$scope.isLoadingAdd=!1),"User is still blocked"==response.data&&($scope.showAlert("You are still blocked","You have exceeded 3 resend requests, try again later."),$scope.isLoadingAdd=!1),$log.info(response)},function(reason){$log.info(reason)})},$scope.showOTPPrompt=function(ev){var confirm=$mdDialog.prompt().title("An OTP code has been sent to you via SMS").textContent("Enter the code below").placeholder("OTP code").ariaLabel("OTP code").targetEvent(ev).ok("Submit").cancel("Re-send Code");$mdDialog.show(confirm).then(function(result){$scope.OTP=result,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/checkEnteredOTP?UserID="+$scope.consumerUserID+"&enteredOTP="+$scope.OTP}).then(function(response){$scope.isValidMsg=response.data,"OTP Expired"===$scope.isValidMsg&&$scope.showAlert("OTP Expired","Please retry adding "+$scope.beneficiaryFirstName+" "+$scope.beneficiaryLastName+" to your beneficiaries"),"OTP Valid"===$scope.isValidMsg&&$http({method:"POST",url:"https://nanofinapifinal.azurewebsites.net/api/ContactList/PostContact",data:{UserID:$scope.consumerUserID,ContactsUserID:$scope.beneficiaryUserID}}).then(function(response){$scope.isLoadingAdd=!1,getUserContactList(),$scope.showAlert("Beneficiary Added Successfully",$scope.beneficiaryFirstName+" "+$scope.beneficiaryLastName+" has been added to your beneficiaries"),$location.url("/viewbeneficiaries")},function(reason){$log.info(reason),$scope.isLoadingAdd=!1}),"OTP Invalid"===$scope.isValidMsg&&($scope.showAlert("OTP Invalid","A new OTP will be sent via SMS shortly"),$scope.showOTPPrompt(),$scope.isLoadingAdd=!1),"User Blocked"===$scope.isValidMsg&&($scope.showAlert("Too many resend requests","You are temporarily blocked from performing this transaction"),$scope.isLoadingAdd=!1)},function(reason){$log.info(reason)})},function(){$scope.OTP="Resend",$scope.isResend=!0,$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/sendUserOTPAndSaveOTP?UserID="+$scope.consumerUserID+"&isResend="+$scope.isResend}).then(function(response){"OTP Resent Successfully"==response.data&&(scope.showAlert("OTP Resent Successfully",""),$scope.showOTPPrompt(),$scope.isLoadingAdd=!1),"User blocked, OTP not Resent"==response.data&&$scope.showAlert("Too many resend requests","You are temporarily blocked from performing this transaction"),$log.info(response)},function(reason){$log.info(reason)})})},$scope.showAlert=function(title,message){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(title).textContent(message).ariaLabel("Alert Dialog").ok("OK")).then(function(){$scope.beneficiaryFound=!1})};var getUserContactList=function(){$http({method:"GET",url:$scope.baseURL+"/ContactList/getUsersContactListWithDetails?UserID="+$scope.consumerUserID}).then(function(response){$scope.contacts=response.data},function(reason){$log.info(reason)})};getUserContactList(),$scope.remove=function(userID){$http({method:"DELETE",url:$scope.baseURL+"/ContactList/deleteContact?UserID="+$scope.consumerUserID+"&ContactUserID="+userID}).then(function(response){$scope.showAlert("Beneficiary Removed","The selected User will no longer be a beneficiary"),getUserContactList(),$log.info(response)},function(reason){$log.info(reason)})}}),angular.module("myApp").directive("ngFiles",["$parse",function($parse){function fn_link(scope,element,attrs){var onChange=$parse(attrs.ngFiles);element.on("change",function(event){onChange(scope,{$files:event.target.files})})}return{link:fn_link}}]).controller("claimCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService){userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN");var pid=$routeParams.param1;$scope.productID=pid,$scope.claimFormData={},$scope.getProductDetails=function(){$http({method:"GET",url:"http://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getSpecificSingleProductDetails?ProductID="+$scope.productID}).then(function(response){$scope.productDetails=response.data,$log.info(response)},function(reason){$log.info(reason)})},$scope.getProductDetails($scope.productID),$scope.getProductClaimTemplate=function(){$http({method:"GET",url:"http://nanofinapifinal.azurewebsites.net/api/Claim/getClaimTemplateJustJson?productID="+$scope.productID}).then(function(response){$scope.productClaimTemplate=JSON.parse(response.data),$log.info(response)},function(reason){$log.info(reason)})},$scope.getProductClaimTemplate($scope.productID);var formdata=new FormData;$scope.getTheFiles=function($files){$scope.imagesrc=[];for(var i=0;i<$files.length;i++){var reader=new FileReader;reader.fileName=$files[i].name,reader.readAsDataURL($files[i])}console.log($files),angular.forEach($files,function(value,key){formdata.append(key,value)})},$scope.uploadFiles=function(){var request={method:"POST",url:"http://localhost:14198/api/FileUpload/UpLoadFiles",data:formdata,headers:{"Content-Type":void 0}};$http(request).success(function(d){alert("File Uploaded!!!!!"),alert(d),$scope.reset()}).error(function(){alert("Failed!"),$scope.reset()})},$scope.reset=function(){angular.forEach(angular.element("input [type = 'file']"),function(inputElem){angular.element(inputElem).val(null)}),$scope.imagesrc=[],formdata=new FormData},$scope.getthefile=function(){$http({method:"GET",cache:!1,url:"http://localhost:10812/api/FileUpload/getfile",headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(data,status){console.log(data),window.open(data,"_blank","")}).error(function(data,status){})},$scope.submitClaim=function(){$http({method:"POST",url:"http://nanofinapibeta.azurewebsites.net/api/TestManager/Postclaim"}).then(function(response){$scope.currentVoucherBalance=$scope.currentVoucherBalance-amount,notificationService.sendSms(recipientUserID,"Hello from NanoFin! You just recieved a NanoBucks voucher valued at R"+amount+". Visit NanoFin.azurewebsites.net to find out more."),$log.info(response)},function(reason){$scope.isLoading=!1,$log.info(reason)})}}),angular.module("myApp").controller("claimHistoryCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService){$scope.baseURL="https://nanofinapifinal.azurewebsites.net",userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.claimsInProgressHistory=[],$scope.searchInProgressClaim="",$scope.sortType="transactionDate",$scope.searchFinalisedClaim="",$scope.pageLoading=!1,$scope.pageFinalizedLoading=!1,$scope.getClaimsInProgressHistory=function(){$scope.pageLoading=!0,$http({method:"GET",url:$scope.baseURL+"/api/Claim/getClaimsInProgress?userID="+$scope.consumerUserID}).then(function(response){$scope.pageLoading=!1,$log.info(response);var vClaimsInProg=response.data;$scope.claimsInProgressHistory=vClaimsInProg},function(reason){$scope.pageLoading=!1,$log.info(reason)})},$scope.getClaimsInProgressHistory(),$scope.getClaimsFinalizedHistory=function(){$scope.pageFinalizedLoading=!0,$http({method:"GET",url:$scope.baseURL+"/api/Claim/getClaimsThatHaveBeenSettled?userID="+$scope.consumerUserID}).then(function(response){$scope.pageFinalizedLoading=!1,$log.info(response);var vClaimsFinalized=response.data;$scope.claimsFinalized=vClaimsFinalized},function(reason){$scope.pageFinalizedLoading=!1,$log.info(reason)})},$scope.getClaimsFinalizedHistory()}),angular.module("myApp").directive("fileInput",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){element.bind("change",function(){$parse(attrs.fileInput).assign(scope,element[0].files),scope.$apply()})}}}]).controller("claimSimpleCtrl",function($scope,$http,notificationService,userSessionService,$location,$mdDialog,$log,$routeParams,$window){$scope.apiBaseUrl="https://nanofinapifinal.azurewebsites.net",userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN");var apid=$routeParams.param1;$scope.activeProd_ID=apid;var pid=$routeParams.param2;$scope.productID=pid,$scope.date=new Date,$scope.productName="";var currentTime=new Date;$scope.year=currentTime.getFullYear(),$scope.month=currentTime.getMonth()+1,$scope.IM_id=0;var vm=this;vm.currentStep=1,vm.steps=[],$scope.saving=!1,$scope.pageLoading=!0;var getCustomerID=function(){$http({method:"GET",url:$scope.apiBaseUrl+"/api/Claim/getCustomerID?UserID="+$scope.consumerUserID}).then(function(response){$scope.consumerID=response.data,$log.info(response)},function(reason){$log.info(reason)})};getCustomerID();var getActiveProductDetails=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/GetConsumerSingleActiveProductItemWithDetail?activeProductitemsID="+$scope.activeProd_ID}).then(function(response){$scope.pageLoading=!1;var varActProdDetails=response.data;$scope.activeProductDetails=varActProdDetails;var pIM_id=varActProdDetails.ProductProvider_ID;$scope.IM_id=pIM_id;var prodName=varActProdDetails.productName;$scope.productName=prodName;var policyNumber=varActProdDetails.activeProductItemPolicyNum;$scope.policyNum=policyNumber,$log.info(response)},function(reason){$log.info(reason)})};getActiveProductDetails();var getProductClaimTemplate=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/Claim/getClaimTemplateJustJson?productID="+$scope.productID}).then(function(response){$scope.pageLoading=!1,vm.steps=angular.fromJson(response.data),$log.info(response)},function(reason){$log.info(reason)})};getProductClaimTemplate(),$scope.uploading=!1;var fd=new FormData;$scope.upload=function(files){if($scope.uploading=!0,console.log(files),0===files.length)return alert("No files selected!"),void($scope.uploading=!1);for(var i=0;i<files.length;i++){var fsize=files.item(i).size;if(console.log("file size:"+fsize),fsize/1024>=2048)return $scope.showMaxFileSizeAlert(),void($scope.uploading=!1);var fileExtension=$scope.getFileExt(files.item(i).name);if("exe"===fileExtension)return alert("Don't allow this file type!"),void($scope.uploading=!1)}angular.forEach(files,function(value,key){fd.append(key,value)}),$http.post($scope.apiBaseUrl+"/api/FileUpload/uploadToNewDirectory?strDirectory=claims/"+$scope.productName+"/"+$scope.activeProd_ID,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(d){$scope.uploading=!1,$scope.showAlert(files),console.log(d)}).error(function(){$scope.uploading=!1,alert("Failed!")})},$scope.showMaxFileSizeAlert=function(){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("The size of one or more files is more than 2 MiB").textContent("Please try to upload files of smaller sizes.").ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.getFileExt=function(string){var array=string.split(".");return array[1]},$scope.showAlert=function(files){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("File(s) Uploaded Successfully:").textContent($scope.NamesList(files)).ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.NamesList=function(files){for(var namesStr="",i=0;i<files.length;i++)namesStr=namesStr+files[i].name+"  \r\n";return namesStr},vm.gotoStep=function(newStep){vm.currentStep=newStep},vm.getStepTemplate=function(){for(var i=0;i<vm.steps.length;i++)if(vm.currentStep==vm.steps[i].step)return vm.steps[i].fields},$scope.showClaimAlert=function(claimID){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Claim submitted Successfully!").textContent("Claim reference #: "+claimID+" for your "+$scope.productName+" product").ariaLabel("Alert Dialog Demo").ok("OK")).then(function(){$location.url("/wallet")})},$scope.showConfirm=function(steps){var confirm=$mdDialog.confirm().title("Claim confirmation").textContent("Please confirm the submission of your claim by clicking 'Confirm' ").ariaLabel("Lucky day").ok("Confirm").cancel("Cancel");$mdDialog.show(confirm).then(function(){$scope.saving=!0,$http({method:"POST",url:"https://nanofinapifinal.azurewebsites.net/api/Claim/Postclaim",data:{Consumer_ID:$scope.consumerID,ActiveProductItems_ID:$scope.activeProd_ID,capturedClaimFormDataJson:JSON.stringify(steps),claimDate:$scope.date,claimStatus:"In Progress",claimPaymentFinalised:"false"}}).then(function(response){$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Claim/incrementConsumerNumClaims?consumerID="+$scope.consumerID}).then(function(response){$log.info(response)},function(reason){$log.info(reason)}),$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/Claim/GetClaimID?activeProductID="+$scope.activeProd_ID}).then(function(response){var claimID=response.data;$scope.sClaimID=claimID,$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Claim/setIsActiveToFalse?activeProductID="+$scope.activeProd_ID}).then(function(response){$log.info(response)},function(reason){$log.info(reason)});var uploadpath="/UploadFiles/claims/"+$scope.productName+"/"+$scope.activeProd_ID;$scope.scUploadPath=uploadpath,$http({method:"POST",url:$scope.apiBaseUrl+"/api/Claim/Postclaimuploaddocument?userID="+$scope.consumerUserID+"&activeProductItemsID="+$scope.activeProd_ID+"&claimUploadDocPath="+$scope.scUploadPath+"&claimID="+$scope.sClaimID}).then(function(response){notificationService.sendSms($scope.consumerUserID,"Hello from NanoFin! You just submitted a claim online for your "+$scope.productName+" product. Contact 0866275213 or visit nanofinlocal.azurewebsites.net for more info."),$log.info(response)},function(reason){$log.info(reason)}),$scope.showClaimAlert(claimID),$log.info(response)},function(reason){$log.info(reason)}),$scope.saving=!1,$log.info(response)},function(reason){$scope.saving=!1,$log.info("Postclaim not succeeded: "-reason)})},function(){})},vm.save=function(steps){$scope.showConfirm(steps)};var getConsumerDetails=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/GetConsumerProfileInfo?userID="+$scope.consumerUserID}).then(function(response){$scope.userProfileInfo=response.data,$log.info(response)},function(reason){$log.info(reason)})};getConsumerDetails()}),angular.module("myApp").controller("claimwizardCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,$q,$timeout,notificationService,userSessionService,rcWizard,rcForm,rcDisabled){$scope.user={},$scope.saveState=function(){var deferred=$q.defer();return $timeout(function(){deferred.resolve()},5e3),deferred.promise},$scope.completeWizard=function(){alert("Completed!")}}),angular.module("myApp").directive("fileInput",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){element.bind("change",function(){$parse(attrs.fileInput).assign(scope,element[0].files),scope.$apply()})}}}]).controller("consumerSignUpCtrl",function($scope,$http,$mdToast,$log,$timeout,$location,$mdDialog){$scope.baseURL=$scope.baseURL="https://nanofinapifinal.azurewebsites.net",$scope.currentStep=0,$scope.numSteps=4,$scope.showToolTip=!1,$scope.isFormComplete=!1,$scope.showPagination=!0,$scope.showComplete=!1,$scope.showIncompleteBack=!1,$scope.show1=!0,$scope.show2=!1,$scope.show3=!1,$scope.show4=!1,$scope.setForm=function(form){$scope.form=form},$scope.showCurrentDiv=function(divNumber){$scope.show1=!1,$scope.show2=!1,$scope.show3=!1,$scope.show4=!1,1===divNumber?$scope.show1=!0:2===divNumber?$scope.show2=!0:3===divNumber?$scope.show3=!0:4===divNumber&&($scope.show4=!0)},$scope.completeSignup=function(){$scope.show3=!1,postUser()};var postUser=function(){$http({method:"POST",url:$scope.baseURL+"/api/signup/postConsumer?fName="+$scope.consumer.firstName+"&lName="+$scope.consumer.lastName+"&userName="+$scope.consumer.username+"&email="+$scope.consumer.email+"&contactNum="+$scope.consumer.phoneNumber+"&userPass="+$scope.consumer.retypePassword+"&IDnumber="+$scope.consumer.ID+"&DOB="+$scope.consumer.DOB+"&gender="+$scope.consumer.gender+"&maritalStatus="+$scope.consumer.maritalStatus+"&employmentStatus="+$scope.consumer.employmentStatus
}).then(function(response){$log.info(response),console.log("redirect to login"),$location.path("/login")},function(reason){$log.info(reason),console.log("the error"),console.log(reason.data.Message),$scope.currentStep=0,$scope.showCurrentDiv(1),$scope.showPagination=!0,$scope.showComplete=!1,$scope.showIncompleteBack=!1,"email taken"===reason.data.Message?alert("Email has already been taken. Please choose another email"):"Username taken"===reason.data.Message&&alert("Username has already been taken. Please choose another user name.")})};$scope.incrementStep=function(form){$scope.currentStep=$scope.currentStep+1,$scope.currentStep>=$scope.numSteps-1&&(form.$valid===!1?$scope.showIncompleteBack=!0:form.$valid===!0&&($scope.showComplete=!0),$scope.showPagination=!1),$scope.showCurrentDiv($scope.currentStep+1)},$scope.decrementStep=function(){$scope.currentStep=$scope.currentStep-1,$scope.currentStep>0&&($scope.showPagination=!0,$scope.showComplete=!1,$scope.showIncompleteBack=!1),$scope.showCurrentDiv($scope.currentStep+1)};var count=0;$scope.$watch("consumerSignUp.$valid",function(){$scope.consumerSignUp.$valid===!0?0===count?count++:$scope.currentStep>=$scope.numSteps-1&&($scope.showIncompleteBack=!1,$scope.showPagination=!1,$scope.showComplete=!0):$scope.consumerSignUp.$valid===!1&&($scope.currentStep>=$scope.numSteps-1?($scope.showIncompleteBack=!0,$scope.showPagination=!1,$scope.showComplete=!1):($scope.showIncompleteBack=!1,$scope.showPagination=!0,$scope.showComplete=!1))}),$scope.uploading=!1;var fd=new FormData;$scope.upload=function(files){console.log("uploading"),$scope.uploading=!0,console.log(files);for(var i=0;i<files.length;i++){var fsize=files.item(i).size;if(console.log("file size:"+fsize),fsize/1024>=2048)return $scope.showMaxFileSizeAlert(),void($scope.uploading=!1)}angular.forEach(files,function(value,key){fd.append(key,value)}),$http.post($scope.baseURL+"/api/FileUpload/uploadToNewDirectory?strDirectory=userDocs/consumer/ID/"+$scope.consumer.email,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(d){$scope.uploading=!1,$scope.showAlert(files),console.log(d)}).error(function(){$scope.uploading=!1,alert("Failed!")})},$scope.showMaxFileSizeAlert=function(){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("The size of one or more files is more than 2 MiB").textContent("Please try to upload files of smaller sizes.").ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.showAlert=function(files){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("File(s) Uploaded Successfully:").textContent($scope.NamesList(files)).ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.NamesList=function(files){for(var namesStr="",i=0;i<files.length;i++)namesStr=namesStr+files[i].name+"  \r\n";return namesStr}}),angular.module("myApp").controller("customerCtrl",function($scope,$http,notificationService,userSessionService,$location,$window,$log,$mdDialog){userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,$scope.$location=$location,$scope.baseURL="https://nanofinapifinal.azurewebsites.net",$scope.assets=[],$scope.travels=[],$scope.legals=[],$scope.medicals=[],$scope.funerals=[],$scope.valueaddeds=[],$scope.sortType="productName",$scope.sortReverse=!1,$scope.searchProduct="",$scope.productID=0,$scope.pageLoading=!1,$scope.isLoadingSave=!1,$scope.items=[{name:"Khaya Cover",id:31},{name:"Commuter Accident",id:41},{name:"Legal Insurance",id:51},{name:"Trauma And Assault Cover",id:71},{name:"Personal Accident Cover",id:91},{name:"Funeral Cover",id:101},{name:"Cross Border Travel",id:191},{name:"2Help1 Hospital Cash Plan",id:231}],$scope.selected=[],$scope.toggle=function(item,list){var idx=list.indexOf(item.id);idx>-1?list.splice(idx,1):list.push(item.id)},$scope.exists=function(item,list){return list.indexOf(item.id)>-1},$scope.getSelectedFormat=function(selected){var text="";for(i=0;i<selected.length;i++)text+=selected[i]+",";for(text=text.substring(0,text.length-1),text+=";",i=0;i<selected.length;i++)text+="0,";return text=text.substring(0,text.length-1),text+="",$scope.newSelectedItemsFormatted=text,text},$scope.$watch("consumerSignUp.$valid",function(){$scope.consumerSignUp.$valid===!0?$scope.isFormNotCompletedYet=!1:$scope.isFormNotCompletedYet=!0}),$scope.getCatalogProducts=function(insuranceTypeID){$scope.pageLoading=!0,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getSpecificCategoryCatalogInsuranceProducts?insuranceTypeID="+insuranceTypeID}).then(function(response){switch($scope.pageLoading=!1,insuranceTypeID){case 1:$scope.assets=response.data;break;case 2:$scope.travels=response.data;break;case 11:$scope.legals=response.data;break;case 21:$scope.medicals=response.data;break;case 31:$scope.funerals=response.data;break;case 41:$scope.valueaddeds=response.data}})},$scope.getCatalogProducts(1),$scope.getCatalogProducts(2),$scope.getCatalogProducts(11),$scope.getCatalogProducts(21),$scope.getCatalogProducts(31),$scope.getCatalogProducts(41);var getIsAdditDetailsCaptured=function(){$http({method:"GET",url:$scope.baseURL+"/api/ConsumerAdditionalProfileInfo/getIsHomeOwnerTypeNull?userID="+$scope.consumerUserID}).then(function(response){var additIsCompleted=response.data;$scope.additionalDetailsNotCompleted=additIsCompleted,$log.info(response),console.log(response)},function(reason){$log.info(reason)})};getIsAdditDetailsCaptured();var initializeLater=function(){$scope.laterHasBeenSelected=!1};initializeLater(),$scope.laterHasBeenSelected=!1,$scope.goToPurchaseProduct=function(productID){getIsAdditDetailsCaptured(),$scope.laterHasBeenSelected===!0?$location.url("/purchaseproduct/"+productID):$scope.additionalDetailsNotCompleted===!0?$("#myModal").modal():$scope.additionalDetailsNotCompleted===!1&&$location.url("/purchaseproduct/"+productID)},$scope.laterClicked=function(){$scope.laterHasBeenSelected=!0,$("#myModal").modal("hide"),$("#alertLaterModal").modal()},$scope.SaveAdditonalDetails=function(){$scope.isLoadingSave=!0,$http({method:"PUT",url:$scope.baseURL+"/api/ConsumerAdditionalProfileInfo/putAdditionalSignUpInfo?userID="+$scope.consumerUserID+"&consumerAddress="+$scope.consumer.addressline+"&homeOwnerType="+$scope.consumer.homeOwnerType+"&numDependants="+$scope.consumer.numberDependants+"&topProductsInterestedIn="+$scope.getSelectedFormat($scope.selected)+"&grossMonthly="+$scope.consumer.grossMonthlyIncome+"&nettMonthly="+$scope.consumer.nettMonthlyIncome+"&totalExpenses="+$scope.consumer.totalMonthlyExpenses}).then(function(response){$log.info(response),console.log(response),$scope.isLoadingSave=!1,$scope.additionalDetailsNotCompleted=!1,$("#myModal").modal("hide"),$("#alertModal").modal()},function(reason){$log.info(reason)})}}),angular.module("myApp").controller("historyCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService){userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.transactionHistory=[],$scope.searchTransaction="",$scope.sortType="transactionDate";var getTransactionHistory=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getAllHistories?userID="+$scope.consumerUserID}).then(function(response){$scope.transactionHistory=response.data,$log.info(response)},function(reason){$log.info(reason)})};getTransactionHistory()}),angular.module("myApp").controller("profileCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService,$mdDialog,$location){$scope.baseURL="https://nanofinapifinal.azurewebsites.net",userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.userProfileInfo=[],$scope.isLoadingSave=!1;var getConsumerProfile=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/GetConsumerProfileInfo?userID="+$scope.consumerUserID}).then(function(response){$scope.userProfileInfo=response.data,$log.info(response)},function(reason){$log.info(reason)})};getConsumerProfile(),$scope.showAlert=function(ev){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("This is an alert title").textContent("You can specify some description text in here.").ariaLabel("Alert Dialog Demo").ok("Got it!").targetEvent(ev))},$scope.$watch("updateProfForm.$valid",function(){$scope.updateProfForm.$valid===!0?$scope.isFormNotCompletedYet=!1:$scope.isFormNotCompletedYet=!0}),$scope.updateProfileModal=function(){$("#myModal").modal()},$scope.laterClicked=function(){$scope.laterHasBeenSelected=!0,$("#myModal").modal("hide")},$scope.SaveAdditonalDetails=function(){$scope.isLoadingSave=!0,$http({method:"PUT",url:$scope.baseURL+"/api/ConsumerAdditionalProfileInfo/consumerUpdateJustBasicProfile?userID="+$scope.consumerUserID+"&userFirstName="+$scope.consumer.firstName+"&userLastName="+$scope.consumer.lastName+"&UserName="+$scope.consumer.userName+"&userEmail="+$scope.consumer.email+"&userContactNum="+$scope.consumer.contactNumber+"&consumerDateOfBirth="+$scope.consumer.dob+"&consumerAddress="+$scope.consumer.address+"&maritalStatus="+$scope.consumer.maritalStatus}).then(function(response){$log.info(response),console.log(response),$scope.isLoadingSave=!1,$("#myModal").modal("hide"),$scope.showAlertMod(),getConsumerProfile()},function(reason){$log.info(reason)})},$scope.showAlertMod=function(){$("#alertModal").modal()},$scope.deactivateProfile=function(){$scope.disabling=!0,$http({method:"PUT",url:$scope.baseURL+"/api/ConsumerAdditionalProfileInfo/consumerDeactivateProfile?userID="+$scope.consumerUserID}).then(function(response){$log.info(response),console.log(response),$scope.disabling=!1,$location.url("/login")},function(reason){$log.info(reason)})}}),angular.module("myApp").controller("purchaseprodCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService){userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.Accepted=!1,$scope.myDate=new Date;var pid=$routeParams.param1;$scope.productID=pid,$scope.currentVoucherBalance=0,$scope.isLoading=!1,$interval(function(){$scope.isLoading=!1,$scope.$$phase||$scope.$digest()},5e3),$scope.docsreq=[];var getVoucherBalance=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getConsumerVoucherTotal?userID="+$scope.consumerUserID}).then(function(response){$scope.currentVoucherBalance=response.data,$log.info(response)},function(reason){$log.info(reason)})};getVoucherBalance(),$scope.newunitCost=0,$scope.getProductDetails=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getSpecificSingleProductDetails?ProductID="+$scope.productID}).then(function(response){$scope.productDetails=response.data,$scope.newunitCost=response.data.unitCost,$log.info(response)},function(reason){$log.info(reason)})},$scope.getProductDetails($scope.productID),$scope.calcuateTotalAmountSpent=function(unitCost,numUnits){var total=0;return total=unitCost*numUnits,$scope.totalSpentNumber=total,$scope.totalAmount=$filter("currency")(total,"R",2),total};var showToast=function(message,parentId){var parentElement=angular.element(document.getElementById(parentId)),toast=$mdToast.simple().content(message).action("OK").highlightAction(!0).hideDelay(0).position("bottom right").parent(parentElement).hideDelay(5e3);$mdToast.show(toast)};$scope.purchased=!1,$scope.redeemProduct=function(numberUnits,toastParentID,totalAmount,prodName){void 0===numberUnits?showToast("Please enter the number of Units",toastParentID):($scope.isLoading=!0,$http({method:"POST",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/redeemProduct?userID="+$scope.consumerUserID+"&productID="+$scope.productID+"&numberUnits="+numberUnits+"&startdate="+$scope.myDate.toISOString()}).then(function(response){showToast(prodName+" purchased, you will receive an SMS notification shortly",toastParentID),notificationService.sendSms($scope.consumerUserID,"Hello from NanoFin! You just bought a "+prodName+" product of "+totalAmount+" from us. Visit NanoFin.azurewebsites.net to find out more."),$log.info(response),getVoucherBalance(),$scope.purchased=!0,$scope.Accepted=!1,$scope.mNumUnits=0},function(reason){$scope.isLoading=!1,$log.info(reason)}))},$scope.maxNumUnits=0,$scope.checkMax=function(numUnits,unitPrice,totalNanoBucks){$scope.maxNumUnits=totalNanoBucks/unitPrice},$scope.checkMax($scope.mNumUnits,$scope.newunitCost,$scope.currentVoucherBalance),$scope.viewModal=function(){$("#redeemModal").modal()},$scope.AcceptConditions=function(){$scope.Accepted=!0,$("#redeemModal").modal("hide")}}),angular.module("myApp").controller("sendvoucherCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService,$timeout,$q,$mdDialog){function querySearch(query){var deferred,results=query?self.states.filter(createFilterFor(query)):self.states;return self.simulateQuery?(deferred=$q.defer(),$timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise):results}function searchTextChange(text){$log.info("Text changed to "+text)}function selectedItemChange(item){$log.info("Item changed to "+JSON.stringify(item))}function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function(state){return 0===state.value.indexOf(lowercaseQuery)}}$scope.baseURL="https://nanofinapifinal.azurewebsites.net/api",$scope.user=null,$scope.users=null,userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.currentVoucherBalance=0,$scope.isLoading=!1,$interval(function(){$scope.isLoading=!1,$scope.$$phase||$scope.$digest()},5e3);var showToast=function(message,parentId){var parentElement=angular.element(document.getElementById(parentId)),toast=$mdToast.simple().content(message).action("OK").highlightAction(!0).hideDelay(0).position("bottom right").parent(parentElement).hideDelay(5e3);$mdToast.show(toast)},getVoucherBalance=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getConsumerVoucherTotal?userID="+$scope.consumerUserID}).then(function(response){$scope.currentVoucherBalance=response.data,$log.info(response)},function(reason){$log.info(reason)})};getVoucherBalance();var getUserContactList=function(){$http({method:"GET",url:$scope.baseURL+"/ContactList/getUsersContactListWithDetails?UserID="+$scope.consumerUserID}).then(function(response){$scope.contacts=response.data,$log.info(response)},function(reason){$log.info(reason)})};getUserContactList(),$scope.isResend=!1,$scope.sendVoucher=function(amount,recipientID,toastParentID){void 0===amount&&void 0===recipientID?showToast("Please enter amount and select a recipient",toastParentID):void 0===amount?showToast("Please enter amount",toastParentID):void 0===recipientID?showToast("Please select a recipient",toastParentID):($scope.isLoading=!0,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/WalletHandler/getHasSufficientAmount?userID="+$scope.consumerUserID+"&amount="+amount}).then(function(response){hasSufficientFunds=response.data,$log.info(response),hasSufficientFunds===!0?$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/sendUserOTPAndSaveOTP?UserID="+$scope.consumerUserID+"&isResend="+$scope.isResend}).then(function(response){"OTP Sent sucessfully first time"==response.data&&($scope.showOTPPrompt(amount,recipientID),$scope.isLoadingAdd=!1),"User is still blocked"==response.data&&($scope.showAlert("You are still blocked","You have exceeded 3 resend requests, try again later."),$scope.isLoadingAdd=!1),$log.info(response)},function(reason){$log.info(reason)}):$scope.showAlert("Insufficient voucher funds","You need more NanoBucks to perform this transaction")},function(reason){$scope.isLoading=!1,$log.info(reason)}))},$scope.showOTPPrompt=function(amount,recipientUserID){var confirm=$mdDialog.prompt().title("An OTP code has been sent to you via SMS").textContent("Enter the code below").placeholder("OTP code").ariaLabel("OTP code").targetEvent().ok("Submit").cancel("Re-send Code");$mdDialog.show(confirm).then(function(result){$scope.OTP=result,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/checkEnteredOTP?UserID="+$scope.consumerUserID+"&enteredOTP="+$scope.OTP}).then(function(response){$scope.isValidMsg=response.data,"OTP Expired"===$scope.isValidMsg&&$scope.showAlert("OTP Expired","Please retry this send transaction"),"OTP Valid"===$scope.isValidMsg&&$http({method:"POST",url:"https://nanofinapifinal.azurewebsites.net/api/WalletHandler/consumerSendVoucher?consumerUserID="+$scope.consumerUserID+"&recipientID="+recipientUserID+"&transferAmount="+amount}).then(function(response){$scope.currentVoucherBalance=$scope.currentVoucherBalance-amount,notificationService.sendSms(recipientUserID,"Hello from NanoFin! You just received a NanoBucks voucher valued at R"+amount+". Visit NanoFin.azurewebsites.net to find out more."),getVoucherBalance(),$scope.sendForm.amount="",$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/WalletHandler/getUserFirstName?userID="+recipientUserID}).then(function(response){recipientFirstName=response.data,$scope.showAlert("NanoBucks sent successfully to your beneficiary!","Sent "+recipientFirstName+" R"+amount+"!"),$log.info(response)},function(reason){$scope.isLoading=!1,$log.info(reason)}),$log.info(response)},function(reason){$scope.isLoading=!1,$log.info(reason)}),"OTP Invalid"===$scope.isValidMsg&&($scope.showAlert("OTP Invalid","A new OTP will be sent via SMS shortly"),$scope.showOTPPrompt(amount,recipientUserID),$scope.isLoadingAdd=!1),"User Blocked"===$scope.isValidMsg&&($scope.showAlert("Too many resend requests","You are temporarily blocked from performing this transaction"),$scope.isLoadingAdd=!1)},function(reason){$log.info(reason)})},function(){$scope.OTP="Resend",$scope.isResend=!0,$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/sendUserOTPAndSaveOTP?UserID="+$scope.consumerUserID+"&isResend="+$scope.isResend}).then(function(response){"OTP Resent Successfully"==response.data&&(scope.showAlert("OTP Resent Successfully",""),$scope.showOTPPrompt(amount,recipientUserID),$scope.isLoadingAdd=!1),"User blocked, OTP not Resent"==response.data&&$scope.showAlert("Too many resend requests","You are temporarily blocked from performing this transaction"),$log.info(response)},function(reason){$log.info(reason)})})},$scope.showAlert=function(title,message){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(title).textContent(message).ariaLabel("Alert Dialog").ok("OK")).then(function(){$scope.beneficiaryFound=!1})};var self=this;self.isDisabled=!1,self.querySearch=querySearch,self.selectedItemChange=selectedItemChange,self.searchTextChange=searchTextChange}),angular.module("myApp").controller("walletCtrl",function($scope,$http,$routeParams,$log,$interval,$mdToast,$filter,notificationService,userSessionService){userSessionService.isUserLoggedIn()?$scope.consumerUserID=userSessionService.getUserID():$scope.consumerUserID=21,console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.currentVoucherBalance=0,$scope.activeProductItems=[],$scope.searchProduct="",$scope.haspolicynum=!1,$scope.isLoading=!1,$interval(function(){$scope.isLoading=!1,$scope.$$phase||$scope.$digest()},5e3);var getVoucherBalance=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/getConsumerVoucherTotal?userID="+$scope.consumerUserID}).then(function(response){$scope.currentVoucherBalance=response.data,$log.info(response)},function(reason){$log.info(reason)})};getVoucherBalance();var getActiveProductItems=function(){$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/ConsumerWalletHandler/GetConsumerActiveProductitemsWithDetail?userID="+$scope.consumerUserID}).then(function(response){$scope.activeProductItems=response.data,$log.info(response)},function(reason){$log.info(reason)})};getActiveProductItems(),$scope.determinePolicyNum=function(policyNum){return null===policyNum||""===policyNum?($scope.policynum="Policy Number Pending",$scope.noPolicyNumYet=!0,"Policy Number Pending"):($scope.noPolicyNumYet=!1,$scope.policynum=policyNum,policyNum)}}),angular.module("myApp").controller("loginCtrl",function(auth,$scope,$location,store,$http,$log,$window){function onLoginSuccess(profile,token){store.set("profile",profile),store.set("token",token);var id=store.get("profile").user_id.substring(6,store.get("profile").user_id.length);$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/UserHandler/getUserSession?userID="+id}).then(function(response){"Consumer"===response.data.type?$location.path("/catalog"):"Reseller"===response.data.type?$location.path("/reseller"):"Admin"===response.data.type&&$location.path("/admin")},function(reason){console.log("failed")})}function onLoginFailed(){$scope.loading=!1}$scope.user="",$scope.pass="",$scope.submit=function(){String($scope.user).includes("help")?$window.location.href="https://nanofinportal.azurewebsites.net/home":String($scope.user).includes("admin")?$window.location.href="/admin":($scope.loading=!0,auth.signin({popup:!1,sso:!1,connection:"NanoFinDB",username:$scope.user,password:$scope.pass,authParams:{scope:"openid name email"}},onLoginSuccess,onLoginFailed))},$scope.logout=function(){auth.signout(),store.remove("profile"),store.remove("token"),localStorage.removeItem("PGID"),localStorage.removeItem("PGZAR"),$location.path("/login")}}),angular.module("myApp").controller("resellerPerformanceController",function($scope,$http,$log,userSessionService){$scope.baseURL="https://nanofinapifinal.azurewebsites.net",$scope.profitData=[],$scope.profitPerMonthJSON={},userSessionService.isUserLoggedIn()&&($scope.resellerUserID=userSessionService.getUserID());var getProfitRev=function(){$http({method:"GET",url:$scope.baseURL+"/api/Reports/getResellerProfitPerMonth?resellerID="+$scope.resellerUserID}).then(function(response){$scope.profitPerMonthJSON=response.data,$log.info(response),$scope.data=[];var counter=0;$scope.aveProfit=0,$scope.aveRev=0,$scope.bestSellingMonth="",$scope.bestSellingMonthAmount=0;for(var i in $scope.profitPerMonthJSON)$scope.data.push({Period:$scope.profitPerMonthJSON[counter].transactionDate.substring(0,10).toString(),Revenue:Math.round($scope.profitPerMonthJSON[counter].sold),Profit:Math.round($scope.profitPerMonthJSON[counter].sold/10)}),$scope.aveRev+=Math.round($scope.profitPerMonthJSON[counter].sold),$scope.aveProfit+=Math.round($scope.profitPerMonthJSON[counter].sold/10),$scope.bestSellingMonthAmount<Math.round($scope.profitPerMonthJSON[counter].sold)&&($scope.bestSellingMonth=$scope.profitPerMonthJSON[counter].transactionDate.substring(0,7).toString(),$scope.bestSellingMonthAmount=Math.round($scope.profitPerMonthJSON[counter].sold)),counter++;$scope.aveRev=Math.round($scope.aveRev/counter),$scope.aveProfit=Math.round($scope.aveProfit/counter),console.log("PREF REV DATA"),console.log($scope.data),Morris.Bar({element:"profRevGraph",data:$scope.data,xkey:"Period",ykeys:["Revenue","Profit"],labels:["Revenue","Profit"],xLabelAngle:60})},function(reason){$log.info(reason)})};getProfitRev();var getBoughtVsSoldpermonthPie=function(){$http({method:"GET",url:$scope.baseURL+"/api/Reseller/getCurrentMonthSalesAndSoldVouchers?userID="+$scope.resellerUserID}).then(function(response){$scope.profitPerMonthJSON=response.data,$log.info(response),$scope.data=[];var counter=0;for(var i in $scope.profitPerMonthJSON)0===counter?$scope.data.push({value:$scope.profitPerMonthJSON[counter].TransactionAmount,label:"Purchased"}):$scope.data.push({value:$scope.profitPerMonthJSON[counter].TransactionAmount,label:"Sold"}),counter++;console.log("PIE DATA"),console.log($scope.data),Morris.Donut({element:"boughtVsSold",data:$scope.data,formatter:function(x){return"R "+x}}).on("click",function(i,row){console.log(i,row)})},function(reason){$log.info(reason)})};getBoughtVsSoldpermonthPie();var numUnitsSoldPerMonth=function(){$http({method:"GET",url:$scope.baseURL+"/api/Reseller/getNumUnitsSendPerMonth?userID="+$scope.resellerUserID}).then(function(response){$scope.profitPerMonthJSON=response.data,$log.info(response),$scope.data=[];var counter=0;for(var i in $scope.profitPerMonthJSON)$scope.data.push({Period:$scope.profitPerMonthJSON[counter].monthDate,Units:$scope.profitPerMonthJSON[counter].numUnitsSold}),counter++;console.log("NUM UNITS SOLD DATA"),console.log($scope.data),Morris.Line({element:"unitsSoldPerMonth",data:$scope.data,xkey:"Period",ykeys:["Units"],labels:["Units sold"]})},function(reason){$log.info(reason)})};numUnitsSoldPerMonth();var aveAmountSentPerMonth=function(){$http({method:"GET",url:$scope.baseURL+"/api/Reseller/getAverageAmountSentPerMonth?userID="+$scope.resellerUserID}).then(function(response){$scope.profitPerMonthJSON=response.data,$log.info(response),$scope.data=[];var counter=0;for(var i in $scope.profitPerMonthJSON)$scope.data.push({period:$scope.profitPerMonthJSON[counter].monthDate,TransactionAmount:Math.round($scope.profitPerMonthJSON[counter].TransactionAmount)}),counter++;console.log("Ave voucher amount sold per month DATA"),console.log($scope.data),Morris.Line({element:"aveAmountSentPerMonthGraph",data:$scope.data,xkey:"period",ykeys:["TransactionAmount"],labels:["Transaction Amount"]})},function(reason){$log.info(reason)})};aveAmountSentPerMonth()}),angular.module("myApp").controller("resellerCtrl",function($scope,$http,$mdToast,$log,$interval,notificationService,userSessionService,$compile,$sce,$element,$mdDialog,$location,$window){userSessionService.isUserLoggedIn()&&($scope.resellerUserID=userSessionService.getUserID()),console.log(userSessionService.isUserLoggedIn()+"CHECK LOGIN"),$scope.isLoading=!1,$scope.currentVoucherBalance=0,$scope.totalCashEarned=0,$scope.purchasedVouchers_SortOrder="",$scope.sentVouchers_SortOrder="",$scope.ascending=!0,$scope.userDetailsList="",$scope.baseURL="https://nanofinapifinal.azurewebsites.net",$scope.webApp="https://nanofinlocal.azurewebsites.net",$scope.localHost="http://localhost:59760",$interval(function(){$scope.isLoading=!1,$scope.$$phase||$scope.$digest()},5e3),$scope.increment=function(num){num+=1},$scope.showAlertPurchase=function(amount){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Payment Successful").textContent("You purchased R "+amount+" Bulk Voucher").ariaLabel("Alert Dialog Demo").ok("OK"))},$scope.getPurchasedBulkVouchers=function(){$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getResellerPurchasedBulkVouchers?resellerUserID="+$scope.resellerUserID}).then(function(response){$scope.purchasedBulkVouchers=response.data,$log.info(response)},function(reason){$log.info(reason)})};var getCurrentVoucherBalance=function(){$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getVoucherAccountBalance?userID="+$scope.resellerUserID}).then(function(response){$scope.currentVoucherBalance=response.data,$log.info(response),getTotalCashEarned($scope.resellerUserID)},function(reason){$log.info(reason)})},getTotalCashEarned=function(){$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getResellerTotalCashEarned?resellerUserID="+$scope.resellerUserID}).then(function(response){$scope.totalCashEarned=response.data,$log.info(response)},function(reason){$log.info(reason)})};$scope.getSentBulkVouchersWithUserDetails=function(){$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getSentBulkVoucherUserDetails?resellerUserID="+$scope.resellerUserID}).then(function(response){$scope.sentBulkVouchers=response.data;$log.info(response)},function(reason){$log.info(reason)})},getCurrentVoucherBalance($scope.resellerUserID),$scope.getPurchasedBulkVouchers($scope.resellerUserID),$scope.getSentBulkVouchersWithUserDetails($scope.resellerUserID);var showToast=function(message,parentId){var parentElement=angular.element(document.getElementById(parentId)),toast=$mdToast.simple().content(message).action("OK").highlightAction(!0).hideDelay(0).position("bottom right").parent(parentElement).hideDelay(5e3);$mdToast.show(toast)};$scope.buyBulk=function(amount){void 0===amount||$http({method:"POST",url:$scope.baseURL+"/api/WalletHandler/buyBulkVoucher?userID="+$scope.resellerUserID+"&BulkVoucherAmount="+amount}).then(function(response){$scope.currentVoucherBalance=$scope.currentVoucherBalance+amount,$scope.getPurchasedBulkVouchers($scope.resellerUserID),getCurrentVoucherBalance(),$log.info(response)},function(reason){$scope.isLoading=!1,$log.info(reason)})},$scope.paymentCardVisible=!1,$scope.payGateCheckOutHTML="",$scope.payGateCheckOutID="",$scope.isCheckOutPrepared=!1,$scope.initializePayment=function(amount){$http({method:"GET",url:$scope.baseURL+"/api/PaymentGateway/InitRequest?amount="+amount}).then(function(response){$scope.payGateCheckOutID=response.data.id,console.log($scope.payGateCheckOutID),$scope.paymentCardVisible=!0;var checkoutScript=document.createElement("script");checkoutScript.setAttribute("src","https://test.oppwa.com/v1/paymentWidgets.js?checkoutId="+$scope.payGateCheckOutID),document.head.appendChild(checkoutScript),document.getElementById("formToAdd").innerHTML='<form action="'+$scope.webApp+'/reseller" class="paymentWidgets">AMEX MASTER MASTERDEBIT MAESTRO VISA</form>',$log.info(response),localStorage.setItem("PGID",$scope.payGateCheckOutID),localStorage.setItem("PGZAR",amount.toString())},function(reason){$log.info(reason)})},$scope.getStatus=function(status){$http({method:"GET",url:$scope.baseURL+"/api/PaymentGateway/getStatus/"+status}).then(function(response){console.log("call to get status of PG"),$log.info(response)},function(reason){$log.info(reason)})},null!==localStorage.getItem("PGID")?null===localStorage.getItem("firstRedirect")?(localStorage.setItem("firstRedirect","false"),$location.url("/reseller")):(console.log("after pay"),$scope.buyBulk(localStorage.getItem("PGZAR")),$scope.getStatus(localStorage.getItem("PGID")),$scope.showAlertPurchase(localStorage.getItem("PGZAR")),localStorage.removeItem("firstRedirect"),localStorage.removeItem("PGID"),localStorage.removeItem("PGZAR")):console.log("redirect not after pay"),$scope.isResend=!1,$scope.sendBulkVoucher=function(amount,recipienDetails,toastParentID){if($scope.isLoading=!0,void 0===amount&&void 0===recipienDetails)showToast("Please enter amount and recipient details",toastParentID);else if(void 0===amount)showToast("Please enter amount",toastParentID);else if(void 0===recipienDetails)showToast("Please enter recipient details",toastParentID);else{var recipientUserID,hasSufficientFunds;$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getUserDetailsToUserID?input="+recipienDetails}).then(function(response){recipientUserID=response.data,$log.info(response),recipientUserID>0?$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getHasSufficientAmount?userID="+$scope.resellerUserID+"&amount="+amount}).then(function(response){hasSufficientFunds=response.data,$log.info(response),
hasSufficientFunds===!0?$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/sendUserOTPAndSaveOTP?UserID="+$scope.resellerUserID+"&isResend="+$scope.isResend}).then(function(response){"OTP Sent sucessfully first time"==response.data&&($scope.showOTPPrompt(amount,recipientUserID),$scope.isLoadingAdd=!1,$scope.sendBulkForm.amount="",$scope.sendBulkForm.recipientDetails="",$scope.resellerSendVoucher.sendBulkAmount.$error=!1,$scope.resellerSendVoucher.txtSendBulkTo_userDetails.$error=!1,getTotalCashEarned()),"User is still blocked"==response.data&&($scope.showAlert("You are still blocked","You have exceeded 3 resend requests, try again later."),$scope.isLoadingAdd=!1),$log.info(response)},function(reason){$log.info(reason)}):showToast("Insufficient voucher funds",toastParentID)},function(reason){$scope.isLoading=!1,$log.info(reason)}):showToast("Recipient details are incorrect",toastParentID)},function(reason){$scope.isLoading=!1,$log.info(reason),showToast("Recipient details are incorrect",toastParentID)})}},$scope.showAlert=function(title,message){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(title).textContent(message).ariaLabel("Alert Dialog").ok("OK")).then(function(){$scope.beneficiaryFound=!1})},$scope.showOTPPrompt=function(amount,recipientUserID){var confirm=$mdDialog.prompt().title("An OTP code has been sent to you via SMS").textContent("Enter the code below").placeholder("OTP code").ariaLabel("OTP code").targetEvent().ok("Submit").cancel("Re-send Code");$mdDialog.show(confirm).then(function(result){$scope.OTP=result,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/checkEnteredOTP?UserID="+$scope.resellerUserID+"&enteredOTP="+$scope.OTP}).then(function(response){$scope.isValidMsg=response.data,"OTP Expired"===$scope.isValidMsg&&$scope.showAlert("OTP Expired","Please retry this send transaction"),"OTP Valid"===$scope.isValidMsg&&$http({method:"POST",url:$scope.baseURL+"/api/WalletHandler/sendBulkVoucher?resellerUserID="+$scope.resellerUserID+"&recipientID="+recipientUserID+"&transferAmount="+amount}).then(function(response){$scope.currentVoucherBalance=$scope.currentVoucherBalance-amount,$scope.totalCashEarned=$scope.totalCashEarned+.1*amount,$http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/WalletHandler/getUserFirstName?userID="+recipientUserID}).then(function(response){recipientFirstName=response.data,notificationService.sendSms(recipientUserID,"Hello from NanoFin! You just recieved a voucher valued at R"+amount+". Visit NanoFinLocal.azurewebsites.net to find out more."),$scope.showAlert("NanoBucks sent successfully to your customer!","Sent "+recipientFirstName+" R "+amount+"!"),$log.info(response)},function(reason){$scope.isLoading=!1,$log.info(reason)}),$log.info(response)},function(reason){$scope.isLoading=!1,$log.info(reason)}),"OTP Invalid"===$scope.isValidMsg&&($scope.showAlert("OTP Invalid","A new OTP will be sent via SMS shortly"),$scope.showOTPPrompt(amount,recipientUserID),$scope.isLoadingAdd=!1),"User Blocked"===$scope.isValidMsg&&($scope.showAlert("Too many resend requests","You are temporarily blocked from performing this transaction"),$scope.isLoadingAdd=!1)},function(reason){$log.info(reason)})},function(){$scope.OTP="Resend",$scope.isResend=!0,$http({method:"PUT",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/sendUserOTPAndSaveOTP?UserID="+$scope.resellerUserID+"&isResend="+$scope.isResend}).then(function(response){"OTP Resent Successfully"==response.data&&($scope.showAlert("OTP Resent Successfully",""),$scope.showOTPPrompt(amount,recipientUserID),$scope.isLoadingAdd=!1),"User blocked, OTP not Resent"==response.data&&$scope.showAlert("Too many resend requests","You are temporarily blocked from performing this transaction"),$log.info(response)},function(reason){$log.info(reason)})})},$scope.getActiveBulkVouchers=function(){$http({method:"GET",url:$scope.baseURL+"/api/WalletHandler/getResellerActiveBulkVouchers?resellerUserID="+$scope.resellerUserID}).then(function(response){$scope.activeBulkVouchers=response.data,$log.info(response)},function(reason){$log.info(reason)})}}),angular.module("myApp").controller("resellerInfoCtrl",function($scope,$http,$mdToast,$log,$interval,notificationService,userSessionService){function initMap(){var map=new google.maps.Map(document.getElementById("map"),{center:{lat:-26.186204,lng:28.018809},scrollwheel:!1,zoom:15});new google.maps.Marker({position:{lat:-26.185515,lng:28.019232},map:map,title:"Jozi Hub: 44 Stanley Ave, Milpark, Johannesburg"})}initMap()}),function(ng){"use strict";var app=ng.module("ngLoadScript",[]);app.directive("script",function(){return{restrict:"E",scope:!1,link:function(scope,elem,attr){if("text/javascript-lazy"===attr.type){var s=document.createElement("script");s.type="text/javascript";var src=elem.attr("src");if(void 0!==src)s.src=src;else{var code=elem.text();s.text=code}document.head.appendChild(s),elem.remove()}}}})}(angular),angular.module("myApp").factory("FileUploadService",function($http,$log,$q){var fac={};return fac.UploadFile=function(file,description){var formData=new FormData;formData.append("file",file),formData.append("description",description);var defer=$q.defer();return $http.post("http://localhost:14198/api/FileUpload/UpLoadFiles",formData,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(d){defer.resolve(d)}).error(function(){defer.reject("File Upload Failed!")}),defer.promise},fac}),angular.module("myApp").factory("notificationService",function($http,$log,$q){function getPhoneNumFromUserID(userID){var defer=$q.defer();return $http({method:"GET",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/getPhoneNumFromUserID?userID="+userID}).then(function(response){defer.resolve(response),$log.info(response)},function(reason){defer.reject(reason),$log.info(reason)}),defer.promise}var self={};return self.userPhoneNumber=0,self.userID=0,self.setPhoneNumber=function(newNumber){self.userPhoneNumber=newNumber},self.setUserID=function(newUserID){self.userID=newUserID},self.getPhoneNumber=function(newNumber){return self.userPhoneNumber},self.getUserID=function(){return self.userID},self.sendSms=function(userID,message){var promisedPhoneNum=getPhoneNumFromUserID(userID);promisedPhoneNum.then(function(response){self.userPhoneNumber=response.data,$http({method:"POST",url:"https://nanofinapifinal.azurewebsites.net/api/Notification/SendSMS?toPhoneNum="+self.userPhoneNumber+"&message="+message}).then(function(response){console.log("sent sms to: "+self.userPhoneNumber+" with message: "+message),$log.info(response)},function(reason){console.log("failed to send sms"),$log.info(reason)})},function(){console.log("Failed to get phone number from user ID")})},self}),angular.module("myApp").factory("userSessionService",function($http,$log,$q,store){var self={};return self.getUserID=function(){return null===store.get("profile")?-1:store.get("profile").user_id.substring(6,store.get("profile").user_id.length)},self.isUserLoggedIn=function(){return null!==store.get("profile")||null!==store.get("token")},self});